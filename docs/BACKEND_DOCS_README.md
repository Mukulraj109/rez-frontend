# Backend Documentation - Complete Guide

**Comprehensive backend implementation documentation for REZ App**

Created: 2025-10-27

---

## Overview

This folder contains complete documentation for implementing the REZ App backend. These documents were generated by analyzing the entire frontend codebase to identify all API requirements, WebSocket events, and integration needs.

---

## Documentation Files

### 1. **BACKEND_IMPLEMENTATION_GUIDE.md**
üìñ **Main Reference Document**

The most comprehensive guide containing:
- Complete API endpoint specifications
- Request/response schemas with examples
- Authentication & security requirements
- Database schema requirements
- Third-party integration setup
- Error handling standards
- Response format standards
- Rate limiting recommendations

**Use this for:** Detailed implementation of each feature

---

### 2. **BACKEND_QUICK_START.md**
üöÄ **Getting Started Guide**

Fast-track implementation guide with:
- Project structure setup
- Priority implementation order
- Quick implementation templates
- Common patterns and utilities
- Code examples for rapid development
- Testing instructions

**Use this for:** Setting up the project and getting started quickly

---

### 3. **API_CONTRACTS.md**
üìã **TypeScript Interfaces**

Complete TypeScript type definitions for:
- All request payloads
- All response structures
- Common types and interfaces
- Validation schemas
- Error code definitions

**Use this for:** Ensuring type safety and API contract compliance

---

### 4. **WEBSOCKET_EVENTS.md**
‚ö° **Real-time Events**

Complete WebSocket documentation:
- All event names (client‚Üíserver and server‚Üíclient)
- Event payload schemas with examples
- Room/channel management
- Authentication for WebSocket
- Reconnection handling
- Best practices and testing

**Use this for:** Implementing real-time features

---

### 5. **ALL_API_ENDPOINTS_LIST.md**
üìù **Quick Reference**

Complete endpoint list:
- 273+ endpoints organized by feature
- HTTP methods and URLs
- Quick overview of all APIs
- Rate limiting recommendations
- Endpoint count by category

**Use this for:** Quick lookup and reference

---

## Quick Navigation by Feature

### Core Features (Start Here)
1. **Authentication** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 2)
2. **Products & Cart** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 4)
3. **Orders** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 4)
4. **User Profile** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 2)

### Advanced Features
5. **Group Buying** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 4, Item 1)
6. **Store Messaging** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 4, Item 2)
7. **Support Chat** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 4, Item 3)
8. **Bill Verification (OCR)** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 4, Item 4)
9. **Social Media Earnings** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 4, Item 7)
10. **Wishlist Sharing** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 4, Item 8)

### Real-time Features
11. **WebSocket Events** ‚Üí WEBSOCKET_EVENTS.md
12. **Order Tracking** ‚Üí WEBSOCKET_EVENTS.md (Orders section)
13. **Chat/Messaging** ‚Üí WEBSOCKET_EVENTS.md (Support & Store Messaging)

### Integrations
14. **Payment Gateways** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 7)
15. **SMS/OTP** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 7)
16. **File Storage** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 7)
17. **Push Notifications** ‚Üí BACKEND_IMPLEMENTATION_GUIDE.md (Section 7)

---

## Implementation Checklist

### Phase 1: Foundation (Week 1)
- [ ] Set up Express server with TypeScript
- [ ] Configure MongoDB connection
- [ ] Set up Redis for sessions/cache
- [ ] Implement JWT authentication
- [ ] Create user model and auth endpoints
- [ ] Set up error handling middleware
- [ ] Configure CORS and security headers
- [ ] Set up logging (Winston/Morgan)

### Phase 2: Core Commerce (Week 2)
- [ ] Implement product models and endpoints
- [ ] Create category system
- [ ] Build cart functionality
- [ ] Implement order creation
- [ ] Integrate payment gateway (Razorpay)
- [ ] Set up order status tracking
- [ ] Create store models and endpoints

### Phase 3: Enhanced Shopping (Week 3)
- [ ] Build wishlist system
- [ ] Implement reviews and ratings
- [ ] Create search functionality
- [ ] Add product recommendations
- [ ] Set up notification system
- [ ] Implement address management
- [ ] Add coupon/discount system

### Phase 4: Communication (Week 4)
- [ ] Set up WebSocket server
- [ ] Implement store messaging
- [ ] Build support chat system
- [ ] Add real-time order updates
- [ ] Create notification delivery
- [ ] Implement typing indicators

### Phase 5: Advanced Features (Week 5+)
- [ ] Build group buying system
- [ ] Implement bill verification (OCR)
- [ ] Create social media verification
- [ ] Add loyalty/points system
- [ ] Build referral system
- [ ] Implement gamification features
- [ ] Add admin dashboard
- [ ] Create analytics system

---

## Technology Stack Recommendations

### Required
- **Runtime:** Node.js 18+
- **Framework:** Express.js 4.x
- **Database:** MongoDB 6.x
- **Cache:** Redis 7.x
- **WebSocket:** Socket.IO 4.x
- **Language:** TypeScript 5.x

### Recommended
- **Validation:** Joi or Zod
- **Authentication:** jsonwebtoken + bcrypt
- **File Upload:** Multer
- **Image Processing:** Sharp
- **Task Queue:** Bull or Agenda
- **Logging:** Winston
- **API Docs:** Swagger/OpenAPI
- **Testing:** Jest + Supertest

---

## Environment Setup

Copy `.env.example` to `.env` and configure:

```bash
# Core
NODE_ENV=development
PORT=5001
API_BASE_URL=http://localhost:5001/api

# Database
MONGODB_URI=mongodb://localhost:27017/rez_app
REDIS_URL=redis://localhost:6379

# JWT
JWT_SECRET=your-secret-key-here
REFRESH_TOKEN_SECRET=your-refresh-secret-here

# Payment (Get from providers)
RAZORPAY_KEY_ID=
RAZORPAY_KEY_SECRET=
STRIPE_SECRET_KEY=

# SMS/OTP (Get from provider)
SMS_API_KEY=
SMS_SENDER_ID=

# File Storage (Choose one)
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
# OR
CLOUDINARY_CLOUD_NAME=
CLOUDINARY_API_KEY=

# Push Notifications
FIREBASE_PROJECT_ID=
FIREBASE_PRIVATE_KEY=
FIREBASE_CLIENT_EMAIL=
```

See BACKEND_IMPLEMENTATION_GUIDE.md Section 3 for complete environment variables list.

---

## API Standards

### Request Format
```typescript
// GET with query parameters
GET /api/products?page=1&limit=20&category=electronics

// POST with JSON body
POST /api/cart/add
Content-Type: application/json
Authorization: Bearer <token>

{
  "productId": "prod_123",
  "quantity": 2
}
```

### Response Format
```typescript
// Success
{
  "success": true,
  "data": { ... },
  "message": "Optional success message"
}

// Error
{
  "success": false,
  "error": "Error message",
  "errors": {  // Optional validation errors
    "field": ["error1", "error2"]
  }
}

// Paginated
{
  "success": true,
  "data": {
    "items": [...],
    "pagination": {
      "current": 1,
      "pages": 10,
      "total": 100,
      "limit": 10
    }
  }
}
```

---

## Testing the Backend

### Manual Testing
```bash
# Health check
curl http://localhost:5001/health

# Send OTP
curl -X POST http://localhost:5001/api/user/auth/send-otp \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber": "+919876543210"}'

# Get products (authenticated)
curl -X GET http://localhost:5001/api/products \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Using Postman
1. Import environment from BACKEND_QUICK_START.md
2. Set up collections for each feature
3. Use pre-request scripts for auth tokens
4. Share collection with team

### Automated Testing
```bash
# Unit tests
npm run test

# Integration tests
npm run test:integration

# E2E tests
npm run test:e2e

# Coverage
npm run test:coverage
```

---

## Common Patterns

### Controller Pattern
```typescript
export class ProductController {
  async getProducts(req: Request, res: Response) {
    try {
      const products = await ProductService.getProducts(req.query);
      res.json({
        success: true,
        data: products
      });
    } catch (error) {
      res.status(500).json({
        success: false,
        error: error.message
      });
    }
  }
}
```

### Service Pattern
```typescript
export class ProductService {
  static async getProducts(query: any) {
    const { page = 1, limit = 20 } = query;
    const products = await Product.find()
      .skip((page - 1) * limit)
      .limit(limit);
    return products;
  }
}
```

### Middleware Pattern
```typescript
export const authenticate = async (req, res, next) => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = await User.findById(decoded.userId);
    next();
  } catch (error) {
    res.status(401).json({ success: false, error: 'Unauthorized' });
  }
};
```

---

## Database Schema Overview

### User Collection
```javascript
{
  _id: ObjectId,
  phoneNumber: String (unique, required),
  email: String (optional),
  profile: {
    firstName, lastName, avatar, ...
  },
  wallet: {
    balance, totalEarned, totalSpent
  },
  preferences: { ... },
  isVerified: Boolean,
  isOnboarded: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### Product Collection
```javascript
{
  _id: ObjectId,
  name: String (required),
  description: String,
  sku: String (unique),
  category: ObjectId (ref: Category),
  store: ObjectId (ref: Store),
  images: [{ url, alt, isMain }],
  pricing: {
    basePrice, salePrice, discount
  },
  inventory: {
    stock, isAvailable
  },
  ratings: {
    average, count, breakdown
  },
  isActive: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### Order Collection
```javascript
{
  _id: ObjectId,
  orderNumber: String (unique),
  user: ObjectId (ref: User),
  items: [{
    product: ObjectId,
    quantity: Number,
    price: Number
  }],
  totals: {
    subtotal, tax, delivery, total
  },
  payment: {
    method, status, transactionId
  },
  delivery: {
    method, status, address, estimatedDelivery
  },
  status: String (enum),
  timeline: [{ status, message, timestamp }],
  createdAt: Date,
  updatedAt: Date
}
```

See BACKEND_IMPLEMENTATION_GUIDE.md Section 6 for complete schema definitions.

---

## Third-Party Services Setup

### Razorpay (Payment Gateway)
1. Sign up at https://razorpay.com
2. Get API keys from dashboard
3. Enable webhooks for payment verification
4. Test with test mode keys first

### Twilio/MSG91 (SMS)
1. Sign up for SMS service
2. Get API key and sender ID
3. Configure OTP template
4. Test with test numbers

### AWS S3 / Cloudinary (File Storage)
1. Create account and bucket/cloud
2. Set up IAM user with appropriate permissions
3. Get access keys
4. Configure CORS for direct uploads

### Firebase (Push Notifications)
1. Create Firebase project
2. Download service account JSON
3. Enable Cloud Messaging
4. Get FCM server key

### Google Vision (OCR)
1. Enable Cloud Vision API
2. Create service account
3. Download credentials JSON
4. Set up billing (pay-as-you-go)

See BACKEND_IMPLEMENTATION_GUIDE.md Section 7 for detailed setup instructions.

---

## Security Checklist

- [ ] JWT tokens with proper expiration
- [ ] Password hashing with bcrypt
- [ ] Rate limiting on all endpoints
- [ ] Input validation and sanitization
- [ ] SQL/NoSQL injection prevention
- [ ] CORS configuration
- [ ] Helmet.js for security headers
- [ ] HTTPS in production
- [ ] Environment variables protection
- [ ] API key rotation policy
- [ ] Audit logs for sensitive operations
- [ ] File upload restrictions
- [ ] XSS protection
- [ ] CSRF tokens where needed

---

## Performance Optimization

### Caching Strategy
```typescript
// Cache frequently accessed data
const cachedProducts = await redis.get('products:featured');
if (cachedProducts) {
  return JSON.parse(cachedProducts);
}

const products = await Product.find({ featured: true });
await redis.setex('products:featured', 300, JSON.stringify(products));
return products;
```

### Database Indexing
```javascript
// Add indexes for frequently queried fields
ProductSchema.index({ category: 1, isActive: 1 });
ProductSchema.index({ store: 1 });
ProductSchema.index({ 'pricing.finalPrice': 1 });
UserSchema.index({ phoneNumber: 1 }, { unique: true });
OrderSchema.index({ user: 1, createdAt: -1 });
```

### Pagination
```typescript
// Always paginate large datasets
const page = parseInt(req.query.page) || 1;
const limit = parseInt(req.query.limit) || 20;
const skip = (page - 1) * limit;

const products = await Product.find()
  .skip(skip)
  .limit(limit)
  .lean();  // Use lean() for read-only queries

const total = await Product.countDocuments();
```

---

## Monitoring & Logging

### Logging Setup
```typescript
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// Log important events
logger.info('Order created', { orderId, userId, total });
logger.error('Payment failed', { error, orderId });
```

### Health Monitoring
```typescript
// /health endpoint
app.get('/health', async (req, res) => {
  const health = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    mongodb: await checkMongoConnection(),
    redis: await checkRedisConnection()
  };
  res.json(health);
});
```

---

## Deployment Checklist

### Pre-Deployment
- [ ] All tests passing
- [ ] Environment variables configured
- [ ] Database migrations complete
- [ ] Third-party services tested
- [ ] SSL certificates ready
- [ ] Domain configured
- [ ] CDN set up for static files
- [ ] Backup strategy in place

### Production Configuration
- [ ] NODE_ENV=production
- [ ] Proper error logging
- [ ] Rate limiting enabled
- [ ] CORS configured correctly
- [ ] Database backups automated
- [ ] Monitoring alerts set up
- [ ] Load balancing configured
- [ ] Auto-scaling if needed

### Post-Deployment
- [ ] Smoke tests on production
- [ ] Monitor error rates
- [ ] Check performance metrics
- [ ] Verify WebSocket connections
- [ ] Test payment flows
- [ ] Monitor third-party service usage

---

## Support & Resources

### Getting Help
1. Check this documentation first
2. Review code examples in BACKEND_QUICK_START.md
3. Look up specific endpoints in ALL_API_ENDPOINTS_LIST.md
4. Check TypeScript contracts in API_CONTRACTS.md
5. Review WebSocket events in WEBSOCKET_EVENTS.md

### External Resources
- Express.js: https://expressjs.com
- MongoDB: https://docs.mongodb.com
- Socket.IO: https://socket.io/docs
- Razorpay API: https://razorpay.com/docs/api
- Stripe API: https://stripe.com/docs/api

### Frontend Integration
- Frontend expects backend at: `http://localhost:5001/api` (dev)
- All responses must follow standard format (see above)
- WebSocket must run on same port as HTTP
- JWT tokens must be included in Authorization header
- File uploads should support multipart/form-data

---

## Changelog

### 2025-10-27
- Initial documentation created
- Analyzed entire frontend codebase
- Documented 273+ API endpoints
- Created comprehensive guides
- Added WebSocket event specifications
- Included TypeScript contracts

---

## Next Steps

1. **Read BACKEND_QUICK_START.md** to set up your project
2. **Follow the implementation checklist** in phases
3. **Reference BACKEND_IMPLEMENTATION_GUIDE.md** for detailed specs
4. **Use API_CONTRACTS.md** for type definitions
5. **Implement WebSocket** using WEBSOCKET_EVENTS.md
6. **Test endpoints** using ALL_API_ENDPOINTS_LIST.md

---

## License & Credits

Generated by analyzing the REZ App frontend codebase.
Created for backend developers to implement matching APIs.

**Note:** This documentation is based on frontend code analysis. Some endpoints may need adjustment based on actual business requirements and backend architecture decisions.

---

**Happy Coding! üöÄ**
